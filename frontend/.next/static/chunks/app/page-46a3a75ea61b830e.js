(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{117:function(e,a,l){Promise.resolve().then(l.bind(l,6294))},6294:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return ei}});var s=l(3827),r=l(4090),t=l(7082),n=l(9744),i=l(8670),o=l(8727),d=l(3459),c=l(9910),m=l(3832);function g(e){let{onMenuClick:a,onSearch:l,searchQuery:t}=e,[g,x]=(0,r.useState)(!1);return(0,s.jsxs)("header",{className:"h-16 flex items-center px-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("button",{onClick:a,className:"p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(n.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("div",{className:"flex items-center ml-4",children:(0,s.jsx)("img",{src:"https://ssl.gstatic.com/ui/v1/icons/mail/rfr/logo_gmail_lockup_default_1x_r5.png",alt:"Gmail",className:"h-8"})}),(0,s.jsx)("div",{className:"flex-1 max-w-2xl mx-8",children:(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)(i.Z,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gmail-gray"}),(0,s.jsx)("input",{type:"text",placeholder:g?"AI semantic search...":"Search mail",value:t,onChange:e=>l(e.target.value,g),onKeyDown:e=>{"Enter"===e.key&&l(t,g)},className:"w-full pl-12 pr-14 py-3 bg-gmail-lightGray dark:bg-gray-800 rounded-full focus:outline-none focus:bg-white focus:shadow-md dark:focus:bg-gray-700 transition-all"}),(0,s.jsx)("button",{onClick:()=>x(!g),className:"absolute right-3 p-1.5 rounded-full transition-colors ".concat(g?"bg-gmail-blue text-white":"hover:bg-gray-200 dark:hover:bg-gray-700 text-gmail-gray"),title:g?"AI Search enabled":"Enable AI Search",children:(0,s.jsx)(o.Z,{className:"w-4 h-4"})})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(d.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(c.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(m.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gmail-blue text-white flex items-center justify-center ml-2",children:"U"})]})]})}var x=l(7609),u=l(9940),h=l(5879),b=l(9990),y=l(9475),p=l(1524),f=l(489),v=l(6570),j=l(3441),N=l(3665),k=l(94);let w=l(9079).env.NEXT_PUBLIC_API_URL||"http://localhost:8080/api";async function S(e,a){let l=await fetch("".concat(w).concat(e),{...a,headers:{"Content-Type":"application/json",...null==a?void 0:a.headers}});if(!l.ok)throw Error(await l.text()||"API error: ".concat(l.status));return l.json()}let C={getEmails:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new URLSearchParams;e.page&&a.set("page",String(e.page)),e.limit&&a.set("limit",String(e.limit)),e.label&&a.set("label",e.label),void 0!==e.is_read&&a.set("is_read",String(e.is_read)),void 0!==e.is_starred&&a.set("is_starred",String(e.is_starred)),e.search&&a.set("search",e.search);let l=a.toString();return S("/emails".concat(l?"?".concat(l):""))},getEmail:e=>S("/emails/".concat(e)),sendEmail:e=>S("/emails",{method:"POST",body:JSON.stringify(e)}),updateEmail:(e,a)=>S("/emails/".concat(e),{method:"PATCH",body:JSON.stringify(a)}),deleteEmail:e=>fetch("".concat(w,"/emails/").concat(e),{method:"DELETE"}),getThread:e=>S("/threads/".concat(e)),getLabels:()=>S("/labels"),createLabel:(e,a)=>S("/labels",{method:"POST",body:JSON.stringify({name:e,color:a})}),deleteLabel:e=>fetch("".concat(w,"/labels/").concat(encodeURIComponent(e)),{method:"DELETE"}),summarize:e=>S("/ai/summarize",{method:"POST",body:JSON.stringify(e)}),smartCompose:e=>S("/ai/compose",{method:"POST",body:JSON.stringify(e)}),semanticSearch:e=>S("/ai/search",{method:"POST",body:JSON.stringify(e)}),categorize:e=>S("/ai/categorize",{method:"POST",body:JSON.stringify({email_id:e})}),indexEmails:()=>S("/ai/index",{method:"POST"}),indexEmail:e=>fetch("".concat(w,"/ai/index/").concat(e),{method:"POST"})};var E=l(3167);let Z=[{name:"INBOX",icon:u.Z,color:null},{name:"STARRED",icon:h.Z,color:"#fbbc04"},{name:"SENT",icon:b.Z,color:null},{name:"DRAFTS",icon:y.Z,color:null},{name:"SPAM",icon:p.Z,color:null},{name:"TRASH",icon:f.Z,color:null}];function _(e){let{isOpen:a,currentLabel:l,onLabelChange:r,onCompose:t,onManageLabels:n}=e,{data:i}=(0,x.a)({queryKey:["labels"],queryFn:C.getLabels}),o=(null==i?void 0:i.filter(e=>!Z.some(a=>a.name===e.name)))||[];return a?(0,s.jsxs)("aside",{className:"w-64 flex-shrink-0 overflow-y-auto pt-4",children:[(0,s.jsxs)("button",{onClick:t,className:"compose-btn ml-4 mb-4 flex items-center gap-3 px-6 py-4 rounded-2xl bg-white dark:bg-gray-800 hover:bg-gmail-lightGray dark:hover:bg-gray-700",children:[(0,s.jsx)(v.Z,{className:"w-6 h-6 text-gmail-gray"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gmail-gray",children:"Compose"})]}),(0,s.jsxs)("nav",{children:[Z.map(e=>{var a,t;let{name:n,icon:o,color:d}=e;return(0,s.jsxs)("button",{onClick:()=>r(n),className:(0,E.Z)("w-full flex items-center gap-4 px-6 py-2 rounded-r-full transition-colors",l===n?"bg-gmail-selected text-gmail-blue font-semibold":"hover:bg-gmail-hover text-gmail-gray"),children:[(0,s.jsx)(o,{className:"w-5 h-5",style:d?{color:d}:void 0,fill:"STARRED"===n&&l===n?null!=d?d:void 0:"none"}),(0,s.jsx)("span",{className:"flex-1 text-left text-sm",children:n}),(null==i?void 0:null===(a=i.find(e=>e.name===n))||void 0===a?void 0:a.email_count)?(0,s.jsx)("span",{className:"text-xs",children:null===(t=i.find(e=>e.name===n))||void 0===t?void 0:t.email_count}):null]},n)}),o.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 px-6 py-2 mt-4",children:[(0,s.jsx)(j.Z,{className:"w-4 h-4 text-gmail-gray"}),(0,s.jsx)("span",{className:"text-xs font-medium text-gmail-gray",children:"Labels"})]}),o.map(e=>(0,s.jsxs)("button",{onClick:()=>r(e.name),className:(0,E.Z)("w-full flex items-center gap-4 px-6 py-2 rounded-r-full transition-colors",l===e.name?"bg-gmail-selected text-gmail-blue font-semibold":"hover:bg-gmail-hover text-gmail-gray"),children:[(0,s.jsx)(N.Z,{className:"w-5 h-5",style:e.color?{color:e.color}:void 0}),(0,s.jsx)("span",{className:"flex-1 text-left text-sm",children:e.name}),e.email_count>0&&(0,s.jsx)("span",{className:"text-xs",children:e.email_count})]},e.name))]}),(0,s.jsxs)("button",{onClick:n,className:"w-full flex items-center gap-4 px-6 py-2 mt-2 hover:bg-gmail-hover text-gmail-gray rounded-r-full",children:[(0,s.jsx)(k.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm",children:"Manage labels"})]})]})]}):null}var T=l(834),D=l(8469),P=l(9108),L=l(7805),M=l(568),O=l(6399),A=l(3608),R=l(3197),q=l(4559);function I(e){let{email:a,isSelected:l,onClick:r}=e,n=(0,t.NL)(),i=(0,M.D)({mutationFn:e=>{let{id:a,data:l}=e;return C.updateEmail(a,l)},onSuccess:()=>{n.invalidateQueries({queryKey:["emails"]})}});return(0,s.jsxs)("div",{onClick:r,className:(0,E.Z)("email-item flex items-center gap-2 px-4 py-2 cursor-pointer border-b border-gray-100 dark:border-gray-800",l?"bg-gmail-selected":"hover:bg-gmail-hover",!a.is_read&&"bg-white dark:bg-gray-900 font-semibold"),children:[(0,s.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded flex-shrink-0",onClick:e=>e.stopPropagation()}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i.mutate({id:a.id,data:{is_starred:!a.is_starred}})},className:"p-1 flex-shrink-0",children:(0,s.jsx)(h.Z,{className:(0,E.Z)("w-5 h-5",a.is_starred?"text-yellow-400 fill-yellow-400":"text-gmail-gray")})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-48 flex-shrink-0 truncate",children:a.from.name||a.from.email}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 flex items-baseline gap-1",children:[(0,s.jsx)("span",{className:"truncate",children:a.subject}),(0,s.jsxs)("span",{className:"text-gmail-gray font-normal truncate",children:[" ","- ",a.snippet]})]}),(0,s.jsx)("div",{className:"text-xs text-gmail-gray flex-shrink-0 w-16 text-right",children:(e=>{let a=new Date(e);return(0,A.z)(a)?(0,R.WU)(a,"h:mm a"):(0,q.X)(a)?(0,R.WU)(a,"MMM d"):(0,R.WU)(a,"MM/dd/yy")})(a.date)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100",children:[(0,s.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,s.jsx)(O.Z,{className:"w-4 h-4 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,s.jsx)(f.Z,{className:"w-4 h-4 text-gmail-gray"})})]})]})}function K(e){let{label:a,searchQuery:l,useAISearch:t,selectedId:n,onSelect:i,onEmailIdsChange:o}=e,{data:d,isLoading:c,refetch:m,isFetching:g}=(0,x.a)({queryKey:["emails",a,l,t],queryFn:async()=>{if(t&&l){let e=await C.semanticSearch({query:l,limit:50});return{emails:(await Promise.all(e.results.map(async e=>{try{return await C.getEmail(e.email_id)}catch(e){return null}}))).filter(e=>null!==e),total:e.results.length,page:1,limit:50}}return C.getEmails({label:a,search:l})}});return(0,r.useEffect)(()=>{(null==d?void 0:d.emails)&&o&&o(d.emails.map(e=>e.id))},[null==d?void 0:d.emails,o]),(0,s.jsxs)("div",{className:"flex-1 flex flex-col border-r border-gray-200 dark:border-gray-700 min-w-[400px]",children:[(0,s.jsxs)("div",{className:"h-12 flex items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded"}),(0,s.jsx)("button",{onClick:()=>m(),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(T.Z,{className:"w-4 h-4 text-gmail-gray ".concat(g?"animate-spin":"")})}),(0,s.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(D.Z,{className:"w-4 h-4 text-gmail-gray"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gmail-gray",children:[(0,s.jsxs)("span",{children:[(null==d?void 0:d.emails.length)?"1-".concat(d.emails.length):"0"," of ",(null==d?void 0:d.total)||0]}),(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(P.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(L.Z,{className:"w-4 h-4"})})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:c?(0,s.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,s.jsx)(T.Z,{className:"w-6 h-6 text-gmail-gray animate-spin"})}):(null==d?void 0:d.emails.length)===0?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gmail-gray",children:[(0,s.jsx)("p",{className:"text-lg",children:"No emails found"}),(0,s.jsx)("p",{className:"text-sm mt-2",children:l?"Try a different search":"Your inbox is empty"})]}):null==d?void 0:d.emails.map(e=>(0,s.jsx)(I,{email:e,isSelected:n===e.id,onClick:()=>i(e.id)},e.id))})]})}var F=l(2235),G=l(6490),Q=l(3915),U=l(1708),z=l(2934),J=l(2260),X=l(9841);function H(e){let{emailId:a,onClose:l}=e,r=(0,t.NL)(),{data:n,isLoading:i}=(0,x.a)({queryKey:["email",a],queryFn:()=>C.getEmail(a)}),{data:d,refetch:c,isFetching:m}=(0,x.a)({queryKey:["summary",a],queryFn:()=>C.summarize({email_id:a}),enabled:!1}),g=(0,M.D)({mutationFn:e=>C.updateEmail(a,e),onSuccess:()=>{r.invalidateQueries({queryKey:["emails"]}),r.invalidateQueries({queryKey:["email",a]})}});return i||!n?(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gmail-blue"})}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"h-12 flex items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:l,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(F.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(O.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(f.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(G.Z,{className:"w-5 h-5 text-gmail-gray"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(Q.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,s.jsx)(U.Z,{className:"w-5 h-5 text-gmail-gray"})})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,s.jsxs)("div",{className:"max-w-4xl",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl text-gray-900 dark:text-gray-100",children:n.subject}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>c(),disabled:m,className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gmail-lightGray hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-sm",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4 ".concat(m?"animate-pulse":"")}),"AI Summary"]}),(0,s.jsx)("button",{onClick:()=>g.mutate({is_starred:!n.is_starred}),children:(0,s.jsx)(h.Z,{className:"w-5 h-5 ".concat(n.is_starred?"text-yellow-400 fill-yellow-400":"text-gmail-gray")})})]})]}),d&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4 text-gmail-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gmail-blue",children:"AI Summary"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:d.summary})]}),(0,s.jsxs)("div",{className:"flex items-start gap-4 mb-6",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gmail-blue text-white flex items-center justify-center flex-shrink-0",children:(n.from.name||n.from.email)[0].toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:n.from.name||n.from.email}),(0,s.jsxs)("span",{className:"text-sm text-gmail-gray",children:["<",n.from.email,">"]})]}),(0,s.jsxs)("div",{className:"text-sm text-gmail-gray",children:["to ",n.to.map(e=>e.name||e.email).join(", ")]})]}),(0,s.jsx)("div",{className:"text-sm text-gmail-gray",children:(0,R.WU)(new Date(n.date),"MMM d, yyyy, h:mm a")})]}),n.labels&&n.labels.length>0&&(0,s.jsx)("div",{className:"flex gap-2 mb-6",children:n.labels.map(e=>(0,s.jsx)("span",{className:"px-2 py-0.5 text-xs rounded bg-gmail-lightGray dark:bg-gray-800",children:e},e))}),(0,s.jsx)("div",{className:"prose dark:prose-invert max-w-none",children:(0,s.jsx)("div",{className:"whitespace-pre-wrap",children:n.body})}),(0,s.jsxs)("div",{className:"flex gap-3 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsx)(z.Z,{className:"w-4 h-4"}),"Reply"]}),(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsx)(J.Z,{className:"w-4 h-4"}),"Reply all"]}),(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsx)(X.Z,{className:"w-4 h-4"}),"Forward"]})]})]})})]})}var B=l(3758),W=l(7271),Y=l(223),V=l(7277),$=l(706),ee=l(5561);function ea(e){let{onClose:a,replyTo:l}=e,[n,i]=(0,r.useState)(""),[d,c]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),p=(0,t.NL)(),f=(0,M.D)({mutationFn:C.sendEmail,onSuccess:()=>{p.invalidateQueries({queryKey:["emails"]}),a()}}),{data:v,refetch:j,isFetching:N}=(0,x.a)({queryKey:["compose-suggestions",d,m],queryFn:()=>C.smartCompose({prompt:d||"general email",context:m}),enabled:!1}),k=e=>{g(e),y(!1)};return u?(0,s.jsx)("div",{className:"fixed bottom-0 right-20 w-64 bg-white dark:bg-gray-800 shadow-lg rounded-t-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 dark:bg-gray-900 text-white rounded-t-lg cursor-pointer",onClick:()=>h(!1),children:[(0,s.jsx)("span",{className:"text-sm font-medium truncate",children:d||"New Message"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),h(!1)},children:(0,s.jsx)(B.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),a()},children:(0,s.jsx)(F.Z,{className:"w-4 h-4"})})]})]})}):(0,s.jsxs)("div",{className:"fixed bottom-0 right-20 w-[550px] bg-white dark:bg-gray-800 shadow-2xl rounded-t-lg flex flex-col max-h-[70vh]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 dark:bg-gray-900 text-white rounded-t-lg",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"New Message"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:()=>h(!0),className:"p-1 hover:bg-gray-700 rounded",children:(0,s.jsx)(W.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:a,className:"p-1 hover:bg-gray-700 rounded",children:(0,s.jsx)(F.Z,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsx)("input",{type:"text",placeholder:"To",value:n,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 bg-transparent focus:outline-none"})}),(0,s.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsx)("input",{type:"text",placeholder:"Subject",value:d,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 bg-transparent focus:outline-none"})}),(0,s.jsxs)("div",{className:"flex-1 min-h-[200px] relative",children:[(0,s.jsx)("textarea",{placeholder:"Compose email",value:m,onChange:e=>g(e.target.value),className:"w-full h-full px-4 py-3 bg-transparent focus:outline-none resize-none"}),b&&v&&(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-3 max-h-48 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4 text-gmail-blue"}),(0,s.jsx)("span",{className:"text-xs font-medium text-gmail-blue",children:"AI Suggestions"}),(0,s.jsx)("button",{onClick:()=>y(!1),className:"ml-auto text-xs text-gmail-gray hover:text-gray-600",children:"Close"})]}),N?(0,s.jsx)("div",{className:"text-sm text-gmail-gray",children:"Generating suggestions..."}):(0,s.jsx)("div",{className:"space-y-2",children:v.suggestions.map((e,a)=>(0,s.jsx)("button",{onClick:()=>k(e),className:"w-full text-left p-2 text-sm rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:e},a))})]})]})]}),(0,s.jsx)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:()=>{n&&d&&f.mutate({to:n.split(",").map(e=>e.trim()),subject:d,body:m,reply_to:l})},disabled:f.isPending||!n||!d,className:"px-6 py-2 bg-gmail-blue text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:f.isPending?"Sending...":"Send"}),(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:(0,s.jsx)(Y.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:(0,s.jsx)(V.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:(0,s.jsx)($.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:(0,s.jsx)(ee.Z,{className:"w-5 h-5 text-gmail-gray"})}),(0,s.jsx)("button",{onClick:()=>{y(!0),j()},disabled:N,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",title:"Smart Compose",children:(0,s.jsx)(o.Z,{className:"w-5 h-5 text-gmail-blue ".concat(N?"animate-pulse":"")})})]})})]})}var el=l(2413);let es=[{key:"c",description:"Compose new email"},{key:"/",description:"Search"},{key:"r",description:"Refresh inbox"},{key:"e",description:"Archive"},{key:"#",description:"Delete"},{key:"s",description:"Star/unstar"},{key:"Shift+i",description:"Mark as read"},{key:"Shift+u",description:"Mark as unread"},{key:"j",description:"Next email"},{key:"k",description:"Previous email"},{key:"o / Enter",description:"Open email"},{key:"Escape",description:"Close"},{key:"d",description:"Toggle dark mode"},{key:"?",description:"Show shortcuts"}];function er(e){let{onClose:a}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:a,children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(el.Z,{className:"w-5 h-5 text-gmail-blue"}),(0,s.jsx)("h2",{className:"text-lg font-medium",children:"Keyboard Shortcuts"})]}),(0,s.jsx)("button",{onClick:a,className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,s.jsx)(F.Z,{className:"w-5 h-5 text-gmail-gray"})})]}),(0,s.jsx)("div",{className:"p-4 max-h-96 overflow-y-auto",children:(0,s.jsx)("div",{className:"space-y-2",children:es.map(e=>{let{key:a,description:l}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between py-1",children:[(0,s.jsx)("span",{className:"text-sm text-gmail-gray",children:l}),(0,s.jsx)("kbd",{className:"px-2 py-1 text-xs bg-gmail-lightGray dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 font-mono",children:a})]},a)})})}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 text-center",children:(0,s.jsx)("span",{className:"text-sm text-gmail-gray",children:"Press ? to toggle this menu"})})]})})}let et=["#ea4335","#fbbc04","#34a853","#4285f4","#9334e6","#f538a0","#ff6d01","#46bdc6","#7baaf7","#185abc"];function en(e){let{onClose:a}=e,[l,n]=(0,r.useState)(""),[i,o]=(0,r.useState)(et[3]),d=(0,t.NL)(),{data:c}=(0,x.a)({queryKey:["labels"],queryFn:C.getLabels}),m=(0,M.D)({mutationFn:e=>{let{name:a,color:l}=e;return C.createLabel(a,l)},onSuccess:()=>{d.invalidateQueries({queryKey:["labels"]}),n("")}}),g=(0,M.D)({mutationFn:C.deleteLabel,onSuccess:()=>{d.invalidateQueries({queryKey:["labels"]})}}),u=["INBOX","SENT","DRAFTS","SPAM","TRASH","STARRED","IMPORTANT"],h=(null==c?void 0:c.filter(e=>!u.includes(e.name)))||[],b=()=>{l.trim()&&m.mutate({name:l.trim(),color:i})};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:a,children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.Z,{className:"w-5 h-5 text-gmail-blue"}),(0,s.jsx)("h2",{className:"text-lg font-medium",children:"Manage Labels"})]}),(0,s.jsx)("button",{onClick:a,className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,s.jsx)(F.Z,{className:"w-5 h-5 text-gmail-gray"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Create new label"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,s.jsx)("input",{type:"text",value:l,onChange:e=>n(e.target.value),placeholder:"Label name",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-transparent focus:outline-none focus:ring-2 focus:ring-gmail-blue",onKeyDown:e=>{"Enter"===e.key&&b()}}),(0,s.jsx)("button",{onClick:b,disabled:!l.trim()||m.isPending,className:"px-4 py-2 bg-gmail-blue text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:(0,s.jsx)(k.Z,{className:"w-5 h-5"})})]}),(0,s.jsx)("div",{className:"flex gap-2",children:et.map(e=>(0,s.jsx)("button",{onClick:()=>o(e),className:"w-6 h-6 rounded-full ".concat(i===e?"ring-2 ring-offset-2 ring-gray-400":""),style:{backgroundColor:e}},e))})]}),(0,s.jsxs)("div",{className:"p-4 max-h-64 overflow-y-auto",children:[(0,s.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Your labels"}),0===h.length?(0,s.jsx)("p",{className:"text-sm text-gmail-gray",children:"No custom labels yet"}):(0,s.jsx)("div",{className:"space-y-2",children:h.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color||"#9e9e9e"}}),(0,s.jsx)("span",{className:"text-sm",children:e.name}),(0,s.jsxs)("span",{className:"text-xs text-gmail-gray",children:["(",e.email_count,")"]})]}),(0,s.jsx)("button",{onClick:()=>g.mutate(e.name),disabled:g.isPending,className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:(0,s.jsx)(f.Z,{className:"w-4 h-4 text-gmail-gray"})})]},e.name))})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h3",{className:"text-sm font-medium mb-2 text-gmail-gray",children:"System labels"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:u.map(e=>(0,s.jsx)("span",{className:"px-2 py-1 text-xs bg-gmail-lightGray dark:bg-gray-700 rounded",children:e},e))})]})]})})}function ei(){var e;let[a,l]=(0,r.useState)(null),[n,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[c,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)("INBOX"),[h,b]=(0,r.useState)(""),[y,p]=(0,r.useState)(!1),[f,v]=(0,r.useState)(!0),[j,N]=(0,r.useState)([]),k=(0,r.useRef)(null),w=(0,t.NL)(),{toggle:S}=function(){let[e,a]=(0,r.useState)(!1),[l,s]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{s(!0);let e=localStorage.getItem("darkMode");null!==e?a("true"===e):window.matchMedia("(prefers-color-scheme: dark)").matches&&a(!0)},[]),(0,r.useEffect)(()=>{l&&(e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",String(e)))},[e,l]),{isDark:e,toggle:(0,r.useCallback)(()=>{a(e=>!e)},[]),mounted:l}}(),E=(0,r.useCallback)(e=>{let s;if(!j.length)return;let r=a?j.indexOf(a):-1;s="next"===e?r<j.length-1?r+1:0:r>0?r-1:j.length-1,l(j[s])},[j,a]),Z=(0,r.useCallback)(async()=>{if(a)try{let e=await C.getEmail(a);await C.updateEmail(a,{is_starred:!e.is_starred}),w.invalidateQueries({queryKey:["emails"]}),w.invalidateQueries({queryKey:["email",a]})}catch(e){console.error("Failed to star email",e)}},[a,w]);return e={onCompose:()=>i(!0),onSearch:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.focus()},onRefresh:()=>w.invalidateQueries({queryKey:["emails"]}),onStar:Z,onMarkRead:(0,r.useCallback)(async()=>{if(a)try{await C.updateEmail(a,{is_read:!0}),w.invalidateQueries({queryKey:["emails"]})}catch(e){console.error("Failed to mark as read",e)}},[a,w]),onMarkUnread:(0,r.useCallback)(async()=>{if(a)try{await C.updateEmail(a,{is_read:!1}),w.invalidateQueries({queryKey:["emails"]})}catch(e){console.error("Failed to mark as unread",e)}},[a,w]),onDelete:(0,r.useCallback)(async()=>{if(a)try{await C.deleteEmail(a),l(null),w.invalidateQueries({queryKey:["emails"]})}catch(e){console.error("Failed to delete email",e)}},[a,w]),onNextEmail:()=>E("next"),onPrevEmail:()=>E("prev"),onOpenEmail:()=>{j.length&&!a&&l(j[0])},onClose:()=>{n?i(!1):o?d(!1):c?m(!1):a&&l(null)},onGoInbox:()=>u("INBOX"),onGoSent:()=>u("SENT"),onGoStarred:()=>u("STARRED"),onGoTrash:()=>u("TRASH"),onToggleDarkMode:S,onHelp:()=>d(e=>!e)},(0,r.useEffect)(()=>{let a=a=>{var l,s,r,t,n,i,o,d,c,m,g,x,u,h,b,y,p;let f=a.target;if("INPUT"===f.tagName||"TEXTAREA"===f.tagName||f.isContentEditable)return;let v=a.ctrlKey||a.metaKey,j=a.shiftKey;switch(a.key.toLowerCase()){case"c":v||(a.preventDefault(),null===(l=e.onCompose)||void 0===l||l.call(e));break;case"/":a.preventDefault(),null===(s=e.onSearch)||void 0===s||s.call(e);break;case"r":v||(a.preventDefault(),null===(r=e.onRefresh)||void 0===r||r.call(e));break;case"e":v||(a.preventDefault(),null===(t=e.onArchive)||void 0===t||t.call(e));break;case"#":a.preventDefault(),null===(n=e.onDelete)||void 0===n||n.call(e);break;case"s":v||(a.preventDefault(),null===(i=e.onStar)||void 0===i||i.call(e));break;case"i":j&&(a.preventDefault(),null===(o=e.onMarkRead)||void 0===o||o.call(e));break;case"u":j&&(a.preventDefault(),null===(d=e.onMarkUnread)||void 0===d||d.call(e));break;case"j":a.preventDefault(),null===(c=e.onNextEmail)||void 0===c||c.call(e);break;case"k":a.preventDefault(),null===(m=e.onPrevEmail)||void 0===m||m.call(e);break;case"o":case"enter":a.preventDefault(),null===(g=e.onOpenEmail)||void 0===g||g.call(e);break;case"escape":a.preventDefault(),null===(x=e.onClose)||void 0===x||x.call(e);break;case"g":break;case"d":v||(a.preventDefault(),null===(u=e.onToggleDarkMode)||void 0===u||u.call(e));break;case"?":a.preventDefault(),null===(h=e.onHelp)||void 0===h||h.call(e)}"i"!==a.key||v||j||null===(b=e.onGoInbox)||void 0===b||b.call(e),"t"!==a.key||v||j||null===(y=e.onGoSent)||void 0===y||y.call(e),"s"!==a.key||v||j||null===(p=e.onGoStarred)||void 0===p||p.call(e)};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e]),(0,s.jsxs)("div",{className:"h-screen flex flex-col bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[(0,s.jsx)(g,{onMenuClick:()=>v(!f),onSearch:(e,a)=>{b(e),void 0!==a&&p(a)},searchQuery:h}),(0,s.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,s.jsx)(_,{isOpen:f,currentLabel:x,onLabelChange:u,onCompose:()=>i(!0),onManageLabels:()=>m(!0)}),(0,s.jsxs)("main",{className:"flex-1 flex overflow-hidden",children:[(0,s.jsx)(K,{label:x,searchQuery:h,useAISearch:y,selectedId:a,onSelect:l,onEmailIdsChange:N}),a&&(0,s.jsx)(H,{emailId:a,onClose:()=>l(null)})]})]}),n&&(0,s.jsx)(ea,{onClose:()=>i(!1)}),o&&(0,s.jsx)(er,{onClose:()=>d(!1)}),c&&(0,s.jsx)(en,{onClose:()=>m(!1)})]})}}},function(e){e.O(0,[974,224,971,69,744],function(){return e(e.s=117)}),_N_E=e.O()}]);